# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a **network speed testing dashboard** for Cloudflare preferred IP addresses. The project consists of two main components:

1. **Vue.js Frontend Dashboard** - Visualizes and analyzes network connectivity test results
2. **Go-based HTTP/3 Testing Tools** - Multi-protocol HTTP testing toolkit for connectivity analysis

## Key Commands

### Frontend Development (Vue.js)

```bash
# Install dependencies
pnpm install  # or npm install

# Start development server
pnpm dev  # or npm run dev
# Access at http://localhost:5173

# Type checking
pnpm type-check

# Build for production
pnpm build  # runs type-check and build-only in parallel

# Preview production build
pnpm preview

# Extract hosts from test results
pnpm extract
```

### HTTP/3 Testing Tools (Go)

```bash
# Build main testing tool
go build -o http3-test-tool main.go

# Run connectivity tests with verbose output
go run host_connectivity_check.go -verbose -dohip 104.21.95.9 --doh-url https://deno-dns-over-https-server.g18uibxgnb.de5.net/

# Extract hosts from results
go run extract_hosts.go

# Run full test pipeline
pnpm start  # Runs ip-info.js then generate-test-report.js
```

## Architecture Overview

### Frontend Architecture

The Vue.js dashboard follows a **Composition API** structure with reactive data management:

- **Main Component**: `src/components/SpeedDashboard.vue` - Single-file component containing all dashboard logic
- **Data Loading**: Uses Vite's `import.meta.glob` to dynamically load JSON test report files
- **State Management**: Local reactive refs and computed properties (no external state library)
- **UI Framework**: Vuetify 3 with Material Design components
- **Filtering System**: Multi-dimensional filtering (country, ASN, IP version, protocol, hostname)
- **PWA Support**: Service worker with offline caching via vite-plugin-pwa

### Data Flow

1. **Test Reports**: Generated by Go tools and saved as `failed-test-report-*.json` in root directory
2. **Dynamic Loading**: Dashboard automatically discovers and loads all report files on mount
3. **Data Processing**: Reports are merged, filtered, and displayed in real-time
4. **Filter Pipeline**: Results flow through multiple filter stages (hostname search → country → ASN → IP version → protocol → date → status)

### Go Testing Tools Architecture

The HTTP/3 testing toolkit implements a **multi-protocol approach**:

- **`main.go`**: Main HTTP/3 testing client with DNS resolution and protocol negotiation
- **`host_connectivity_check.go`**: Core connectivity testing with DoH/DoQ/DoT support
- **`extract_hosts.go`**: Utility for extracting host information from test results
- **Protocol Stack**: HTTP/3 (via QUIC) → HTTP/2 → HTTP/1.1 with automatic fallback
- **DNS Resolution**: RFC 8484 DoH, traditional DNS, and direct IP modes

## Important Configuration

### Data File Location

Test result files (`failed-test-report-*.json`) must be in the **project root directory**, not in `public/`. The frontend uses `../../failed-test-report-*.json` path pattern to access them.

### Test Report Format

Each JSON report contains:
```json
{
  "report_info": { "generated_at": "timestamp" },
  "test_environment": {
    "ip_info": { "country": "Country", "asn": "AS12345", "as_name": "ISP Name" }
  },
  "top_latency_records": [...],  // Successful tests
  "failed_tests": [...]          // Failed tests
}
```

### Vite Configuration

- **Build Optimization**: Terser removes console.log in production builds
- **PWA Setup**: Auto-update, icon support, and caching strategies
- **Alias**: `@` points to `src/` directory
- **Server**: Runs on port 5173 in development

## Development Patterns

### Adding New Filters

1. Add filter field to `filters.value` object in `SpeedDashboard.vue`
2. Add UI component in the filter section (typically second row)
3. Update `clearFilters()` function to reset new field
4. Implement filter logic in `applyFilters()` function

### Test Data Structure

All test results should include:
- `host`: Target hostname
- `target_ip`: IP address tested
- `ip_version`: "IPv4" or "IPv6"
- `protocol`: "h3", "h2", or "http/1.1"
- `success`: Boolean success flag
- `latency_ms`: Response latency in milliseconds
- `generatedAt`: Test timestamp for date filtering

### Performance Considerations

- **Parallel Loading**: All test reports are loaded concurrently using `Promise.all()`
- **Reactive Filtering**: Filters are applied immediately on value changes
- **Memory Management**: Large datasets are filtered client-side, consider pagination for very large result sets